# 中介者模式(Mediator)

![house-agent](https://tva1.sinaimg.cn/large/008i3skNgy1gwsxj5r5r8j30e8098aat.jpg)

听到"中介"这两个字，大家第一时间会想到房产中介，也许在脑海中已经浮现出那些年自己被中介忽悠来忽悠去的日子，哈哈，您先别急着生气，咱们今天要学习的这种模式还真和中介的这种工作模式有些相似，不信的话我来分析分析。

我们先来设想这样一个场景：如果没有房产中介，买卖双方该如何交易房产呢？我想可能会出现如下的场景：
* 买方：需要和多个卖方联系，查看他们的房源，并与其进行商讨价格，最终和真正有意向的卖方成交。
* 卖方：需要和多个潜在的买家联系，告知他们的自己的房子，并与其进行商讨价格，最终和真正有意向的买方成交。

所以，如果没有中介，买卖双方是一种多对多的联系，互相之间的交流杂乱无章，而且非常耗费人力和物力。如果有了中介，会发生什么呢？
* 买方：只需要找到一个满意的中介，告诉他自己对房子的需求和预算，让他帮忙找需要的房子，如果有合适的房子，及时给自己推荐。
* 卖方：只需要找到一个满意的中介，将自己的房产在这个中介公司挂牌，委托中介出售自己的房屋。

这样看来，买卖双方只需要对接中介即可，中介会将买卖双方的需求进行过滤，让合适的买方买到合适的房子，也让卖方将自己的房子出售给合适的买方，互相都省了不少事情。

软件中也经常有类似的创建，页面中有多个元素互相交互，每个元素的状态改变也会影响到其他元素的状态，当多个元素互相有关联的时候，为了解决页面元素之间的耦合，我们将引入一个"中介"来处理多个元素之间的耦合关系。

* 没有中介的时候，页面元素的状态：
![element-no-mediator](https://tva1.sinaimg.cn/large/008i3skNgy1gwsy4tea8kj30xc0fkmyo.jpg)

* 有中介的时候，页面元素的状态：
![element-with-mediator](https://tva1.sinaimg.cn/large/008i3skNgy1gwsy6bz8brj30xc0fkdha.jpg)
  
## 模式的定义

**中介者模式是一种行为设计模式， 能让你减少对象之间混乱无序的依赖关系。 该模式会限制对象之间的直接交互， 迫使它们通过一个中介者对象进行合作**。

### 所以，中介者模式适用于以下几种场景：

* **当一些对象和其他对象紧密耦合以致难以对其进行修改时， 可使用中介者模式：**
  该模式让你将对象间的所有关系抽取成为一个单独的类， 以使对于特定组件的修改工作独立于其他组件。
* **当组件因过于依赖其他组件而无法在不同应用中复用时， 可使用中介者模式。**
  应用中介者模式后， 每个组件不再知晓其他组件的情况。 尽管这些组件无法直接交流， 但它们仍可通过中介者对象进行间接交流。 如果你希望在不同应用中复用一个组件， 则需要为其提供一个新的中介者类。
* **如果为了能在不同情景下复用一些基本行为， 导致你需要被迫创建大量组件子类时， 可使用中介者模式。**
  由于所有组件间关系都被包含在中介者中， 因此你无需修改组件就能方便地新建中介者类以定义新的组件合作方式。
  
## 模式的结构

![mediator-structure](https://tva1.sinaimg.cn/large/008i3skNgy1gwsyctct7nj30sw0nw40u.jpg)

* **中介者(Mediator):** 接口声明了与组件交流的方法， 但通常仅包括一个通知方法。 组件可将任意上下文 （包括自己的对象） 作为该方法的参数， 只有这样接收组件和发送者类之间才不会耦合。
* **具体中介者(Concrete Mediator):** 封装了多种组件间的关系。 具体中介者通常会保存所有组件的引用并对其进行管理， 甚至有时会对其生命周期进行管理。
* **组件(Component):** 是各种包含业务逻辑的类。 每个组件都有一个指向中介者的引用， 该引用被声明为中介者接口类型。 组件不知道中介者实际所属的类， 因此你可通过将其连接到不同的中介者以使其能在其他程序中复用。

**需要说明的是**：组件并不知道其他组件的情况。 如果组件内发生了重要事件， 它只能通知中介者。 中介者收到通知后能轻易地确定发送者， 这或许已足以判断接下来需要触发的组件了。 对于组件来说， 中介者看上去完全就是一个黑箱。 发送者不知道最终会由谁来处理自己的请求， 接收者也不知道最初是谁发出了请求。

## 模式的优缺点

### 优点
* **单一职责原则：** 你可以将多个组件间的交流抽取到同一位置， 使其更易于理解和维护。
* **开闭原则**： 你无需修改实际组件就能增加新的中介者。
* 你可以减轻应用中多个组件间的耦合情况，从而更方便的使用各个组件。

### 缺点
* 一段时间后， 中介者可能会演化成为上帝对象。

