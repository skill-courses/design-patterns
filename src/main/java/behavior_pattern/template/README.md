# 模板方法(Template Method)

![tea-coffee](https://tva1.sinaimg.cn/large/008i3skNgy1gxujbisvaij30vo0nrwiv.jpg)

茶和咖啡应该是大家最喜欢的饮料之一啦，不管是有人喜欢喝茶，还是有人喜欢喝咖啡，其实他们两者的制作过程大体上是一致的：

|  茶 | 咖啡 |
|:----:|:----:|
|把水煮沸|把水煮沸|
|用沸水冲泡茶叶|用沸水冲咖啡粉|
|把茶倒进杯子|把咖啡倒进杯子| 
|加点糖|糖和牛奶|

从他们的制作过程中，我们可以将两者的共同步骤提取出来：
1. 把水煮沸 
2. 冲泡
3. 把饮料倒进杯子
4. 加调料

提取出标准步骤之后，我们就可以将其固定下来，制作称为《饮料制作指南》，供泡茶师和咖啡师来使用。

这个《饮料制作指南》在软件中，属于一种典型的设计模式：***模板方法***。今天我们就来学习它！

## 模式定义

***模板方法模式是一种行为设计模式， 它在超类中定义了一个算法的框架， 允许子类在不修改结构的情况下重写算法的特定步骤。***

模板方法模式建议将算法分解为一系列步骤， 然后将这些步骤改写为方法， 最后在 “模板方法” 中依次调用这些方法。 步骤可以是抽象的， 也可以有一些默认的实现。 为了能够使用算法， 客户端需要自行提供子类并实现所有的抽象步骤。 如有必要还需重写一些步骤（但这一步中不包括模板方法自身）。

通常而言，模板方法适用于如下的场景中：
* 当你只希望客户端扩展某个特定算法步骤， 而不是整个算法或其结构时， 可使用模板方法模式。
* 当多个类的算法除一些细微不同之外几乎完全一样时， 你可使用该模式。 但其后果就是， 只要算法发生变化， 你就可能需要修改所有的类。

## 模式结构

![template-method-structure](https://tva1.sinaimg.cn/large/008i3skNgy1gxujobkkvjj30iw0l4dgv.jpg)

主要角色及其职责如下：
1. **抽象类(Abstract class)**: 会声明作为算法步骤的方法， 以及依次调用它们的实际模板方法。 算法步骤可以被声明为 抽象类型， 也可以提供一些默认实现。
2. **具体类(Concrete Class)**: 可以重写所有步骤， 但不能重写模板方法自身。

## 模式优缺点

### 优点
* 你可仅允许客户端重写一个大型算法中的特定部分， 使得算法其他部分修改对其所造成的影响减小。
* 你可将重复代码提取到一个超类中。

### 缺点
* 部分客户端可能会受到算法框架的限制。
* 通过子类抑制默认步骤实现可能会导致违反_里氏替换原则_。
* 模板方法中的步骤越多， 其维护工作就可能会越困难。


