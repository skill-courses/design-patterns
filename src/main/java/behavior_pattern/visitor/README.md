# 访问者模式(Visitor)

![salesman](https://tva1.sinaimg.cn/large/008i3skNgy1gxv15kepguj30xc0go0ux.jpg)

假如有这样一位非常希望赢得新客户的资深保险代理人。 他可以拜访街区中的每栋楼， 尝试向每个路人推销保险。 所以， 根据大楼内组织类型的不同， 他可以提供专门的保单：

* 如果建筑是居民楼， 他会推销医疗保险。
* 如果建筑是银行， 他会推销失窃保险。
* 如果建筑是咖啡厅， 他会推销火灾和洪水保险。

从上面的场景中可以看出，这是一位非常有经验的保险代理人，他很懂得什么样的客户需要什么样的保险，能够根据客户的需要来定制保险类型。这在软件学中，属于典型的***访问者模式***。

## 模式定义

***访问者模式属于一种行为设计模式，它使你可以在不改变各元素的类的前提下定义作用于这些元素的新操作。***

访问者模式提供了一种访问对象元素中各元素或属性的一种操作，将操作算法与其作用的对象进行了隔离。

通常我们会在以下场景中使用访问者模式：
*  **如果你需要对一个复杂对象结构 （例如对象树） 中的所有元素执行某些操作， 可使用访问者模式。**

访问者模式通过在访问者对象中为多个目标类提供相同操作的变体， 让你能在属于不同类的一组对象上执行同一操作。

* **可使用访问者模式来清理辅助行为的业务逻辑。**
  
该模式会将所有非主要的行为抽取到一组访问者类中， 使得程序的主要类能更专注于主要的工作。

* **当某个行为仅在类层次结构中的一些类中有意义， 而在其他类中没有意义时， 可使用该模式。**

你可将该行为抽取到单独的访问者类中， 只需实现接收相关类的对象作为参数的访问者方法并将其他方法留空即可。

## 模式结构

![visitor-structure](https://tva1.sinaimg.cn/large/008i3skNgy1gxv1h1mwmvj30sw0u0419.jpg)

* **访问者(Visitor): 接口声明了一系列以对象结构的具体元素为参数的访问者方法。 如果编程语言支持重载，这些方法的名称可以是相同的，但是其参数一定是不同的。
* **具体访问者(Concrete Visitor)**: 会为不同的具体元素类实现相同行为的几个不同版本。
* **元素(Element)**: 接口声明了一个方法来 “接收” 访问者。 该方法必须有一个参数被声明为访问者接口类型。
* **具体元素(Concrete Element)**: 必须实现接收方法。 该方法的目的是根据当前元素类将其调用重定向到相应访问者的方法。 请注意， 即使元素基类实现了该方法， 所有子类都必须对其进行重写并调用访问者对象中的合适方法。

## 模式优缺点

### 优点
* 开闭原则： 你可以引入在不同类对象上执行的新行为， 且无需对这些类做出修改。
* 单一职责原则： 可将同一行为的不同版本移到同一个类中。
* 访问者对象可以在与各种对象交互时收集一些有用的信息。 当你想要遍历一些复杂的对象结构 （例如对象树）， 并在结构中的每个对象上应用访问者时， 这些信息可能会有所帮助。

### 缺点
* 每次在元素层次结构中添加或移除一个类时， 你都要更新所有的访问者。
* 在访问者同某个元素进行交互时， 它们可能没有访问元素私有成员变量和方法的必要权限。